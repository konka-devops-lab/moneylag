apiVersion: 1

groups:
  - orgId: 1
    name: springboot-alerts
    folder: Docker-SpringBoot
    interval: 1m
    rules:

      # 1️⃣ Application DOWN
      - uid: app-down
        title: Spring Boot Application Down
        condition: A
        data:
          - refId: A
            datasourceUid: prometheus
            model:
              expr: up{job="springboot-crud-app"} == 0
              instant: true
        for: 1m
        labels:
          severity: critical
          environment: docker
          component: backend
        annotations:
          summary: Spring Boot application is DOWN
          description: Prometheus cannot scrape the Spring Boot container

      # 2️⃣ HTTP 5xx Errors
      - uid: http-5xx
        title: HTTP 5xx Errors Detected
        condition: A
        data:
          - refId: A
            datasourceUid: prometheus
            model:
              expr: rate(http_server_requests_seconds_count{status=~"5.."}[5m]) > 0
              instant: false
        for: 2m
        labels:
          severity: warning
          environment: docker
          component: backend
        annotations:
          summary: HTTP 5xx errors detected
          description: Spring Boot is returning server errors

      # 3️⃣ High Latency (p95)
      - uid: high-latency
        title: High HTTP Latency (p95)
        condition: A
        data:
          - refId: A
            datasourceUid: prometheus
            model:
              expr: |
                histogram_quantile(
                  0.95,
                  rate(http_server_requests_seconds_bucket[5m])
                ) > 1
              instant: false
        for: 3m
        labels:
          severity: warning
          environment: docker
          component: backend
        annotations:
          summary: High request latency
          description: p95 latency is greater than 1 second

      # 4️⃣ JVM Heap Usage High
      - uid: jvm-heap
        title: JVM Heap Usage High
        condition: A
        data:
          - refId: A
            datasourceUid: prometheus
            model:
              expr: |
                (
                  jvm_memory_used_bytes{area="heap"}
                  /
                  jvm_memory_max_bytes{area="heap"}
                ) > 0.8
              instant: false
        for: 5m
        labels:
          severity: warning
          environment: docker
          component: backend
        annotations:
          summary: JVM heap usage high
          description: Heap usage above 80%

      # 5️⃣ DB Connection Pool Saturation
      - uid: db-pool
        title: DB Connection Pool Near Exhaustion
        condition: A
        data:
          - refId: A
            datasourceUid: prometheus
            model:
              expr: |
                hikaricp_connections_active
                /
                hikaricp_connections_max
                > 0.8
              instant: false
        for: 2m
        labels:
          severity: warning
          environment: docker
          component: database
        annotations:
          summary: DB connection pool saturation
          description: HikariCP pool usage above 80%
